---
title: "Methods"
author: Steven Bachman
date: 29th October 2018
output: md_document
---

This document describes methods used in the paper **'Progress, challenges and opportunities for plant Red Listing'**. Each numbered section header relates to numbered sections in the manuscript. See section **'04_outputs'** for the manuscript.

#### 1. Introduction 

```{r echo=FALSE}
# RL key needed for download. ***change this to your own key- get from iucn.org 
rlkey <- "cf3cf316d5dd72945456d42a633ac92357f6b8039bf1d512cc58e26d6169a8f3" # my key
#rlkey = "9bb4facb6d23f48efbf424bb05c0c1ef1cf6f468393bc745d42179ac4aca5fee" # IUCN key
```

*Total number of taxa on the Red List:*
```{r}
#install.packages("rredlist")
library(rredlist)

# get the total number of taxa
rredlist::rl_sp_count(key = rlkey)
```

```{r}
# note the version of the Red List
rredlist::rl_version(key = rlkey)
```


*Total number of species on the Red List:*
```{r}
# this function will get basic data from the Red List
rl_all_IDs = function(rlkey){
  
  # get page with 10,000   
  i=1
  testcount = 1
  rl = rl_sp(0, key = rlkey)
  rl.all = rl$result
  
  # use 'while' to loop through pages until there are no more pages
  while ((testcount)>'0'){
    test = rl_sp(i, key = rlkey)
    testcount = test$count
    rl.all = rbind(rl.all,test$result)
    i = i+1
  }
return(rl.all)  

}
```

Run the rl_all_IDs function to get the full red list of taxa. 
Subset to remove infra rank and populations to get all species

```{r}
# run rl_all_IDs to get dataframe of all taxa on Red List 
all_taxa = rl_all_IDs(rlkey)

# subset to remove subspecies and infra ranks
all_RL_species = subset(all_taxa, is.na(all_taxa$infra_rank) & is.na(all_taxa$population))

# print total number of 'species' on Red List
nrow(all_RL_species)
```


#### 1.1 Gaps in Red List coverage – why the missing species matter
*Percentage of described vertebrate species that have been Red Listed:*

Estimated number of described species of vertebrates, invertebrates, plants and fungi. 
Source: http://cmsdocs.s3.amazonaws.com/summarystats/2018-1_Summary_Stats_Page_Documents/2018_1_RL_Stats_Table_1.pdf

```{r}
# subset all species to get only vertebrates
all.verts = subset(all_RL_species, all_RL_species$phylum_name == "CHORDATA")

# estimated number of described species of VERTEBRATES
described.verts = 69276

# proportion vert species described that have been Red Listed
prop.verts.RL = nrow(all.verts)/described.verts

# print proportion vert species described that have been Red Listed
prop.verts.RL

```

*Percentage of described invertebrates, plants and fungi species that have been Red Listed:*

```{r}
# subset all species to get only plants
all.plants = subset(all_RL_species, all_RL_species$kingdom_name == "PLANTAE") #KINGDOM = PLANTAE
all.plants.count = nrow(all.plants)
all.plants.count
```

```{r}
# fungi and protists covered in two kingdoms so use 'which' and pipe symbol to combine
all.fungi = all_RL_species[ which(all_RL_species$kingdom_name == "FUNGI" | all_RL_species$kingdom_name == "CHROMISTA"),]
all.fungi.count = nrow(all.fungi)
all.fungi.count
```

```{r}
# inverts is any animalia that isn't phylum CHORDATA so use kingdom == ANIMALIA & phylum != CHORDATA
all.inverts = all_RL_species[ which(all_RL_species$kingdom_name == "ANIMALIA" & all_RL_species$phylum_name != "CHORDATA"),]
all.inverts.count = nrow(all.inverts)
all.inverts.count
```

```{r}
all.RL.nonverts =  all.plants.count + all.fungi.count + all.inverts.count
all.RL.nonverts
```

Estimated number of described species of invertebrates, plants and fungi. 
Source: http://cmsdocs.s3.amazonaws.com/summarystats/2018-1_Summary_Stats_Page_Documents/2018_1_RL_Stats_Table_1.pdf

For vascular plants source: LUGHADHA, EIMEAR NIC, RAFAËL GOVAERTS, IRINA BELYAEVA, NICHOLAS BLACK, HEATHER LINDON, ROBERT ALLKIN, ROBERT E. MAGILL, & NICKY NICOLSON. "Counting counts: revised estimates of numbers of accepted species of flowering plants, seed plants, vascular plants and land plants with a review of other recent estimates"Phytotaxa [Online], 272.1 (2016): 82–88. Web. 30 Oct. 2018

```{r}
described.vasc.plants.niclughadha2016 = 383671
described.fungi = 52280
described.inverts = 1305250
described.nonvert = described.vasc.plants.niclughadha2016 + described.fungi + described.inverts

# proportion described invertebrates, plants and fungi species that have been Red Listed
prop.nonverts.RL = all.RL.nonverts/described.nonvert

# print proportion vert species described that have been Red Listed
prop.nonverts.RL * 100
```

#### 1.2 Growing the Red List - vascular plants as a case study
filter on vascular plants only and compare with best estimate for total number of vascular plants i.e. Nic Lughadha et al 2016
```{r}
vasc_plants = subset(all.plants, all.plants$phylum_name == "TRACHEOPHYTA") #PHYLUM = TRACHEOPHYTA (vascular plants)

nrow(vasc_plants)/described.vasc.plants.niclughadha2016*100
```

#### 2.3 Batch assessment upload with ‘SIS Connect’
Percentage of assessments published on the Red List via SIS Connect
Craig Hilton-Taylor, pers. comm (10th August 2018)

```{r}
sis_connect_pub = 509
print(paste0('Assessments published via SIS Connect = ',sis_connect_pub))
sis_connect_pre_pub = 915
print(paste0('Assessments in SIS Connect pipeline = ',sis_connect_pre_pub))
```

#### 2.4 Inclusion of assessments in languages other than English

List of mega diverse countries derived from this source:
http://www.biodiversitya-z.org/content/megadiverse-countries.pdf

```{r}
# read in table of mega diverse countries
mega_diverse_countries <- read.csv("01_data/mega_diverse countries.csv")

# get the number of megadiverse countries that speak Spanish, Portuguese or French as main language
country.count = nrow(subset(mega_diverse_countries, mega_diverse_countries$Span.Port.or.French == "Yes"))
country.count
```
```{r}
# Red list assessments in other languages
brazil_2016_prt = 20
haiti_2018_1_frnch = 38
```
